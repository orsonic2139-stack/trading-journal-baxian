<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Quest - Trading Journal</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="quest.css">
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    /* Daily Quest é¡µé¢ä¸“ç”¨æ ·å¼ - ä¼˜åŒ–ç‰ˆ */
    
    /* é¡µé¢å®¹å™¨ */
    .quest-container {
      max-width: 1400px;
      margin: 1.5rem auto;
      padding: 0 1.5rem;
    }
    
    /* é¡µé¢æ ‡é¢˜åŒºåŸŸ */
    .quest-header {
      text-align: center;
      margin-bottom: 1.5rem;
      padding: 1.5rem;
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.7), rgba(30, 41, 59, 0.5));
      border-radius: 20px;
      border: 1px solid rgba(59, 130, 246, 0.15);
      position: relative;
      overflow: hidden;
    }
    
    .quest-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #3eb489, #3b82f6, #0ee7ff);
    }
    
    .quest-header h1 {
      font-size: 1.8rem;
      margin-bottom: 0.6rem;
      background: linear-gradient(135deg, #3eb489, #0ee7ff, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
      letter-spacing: -0.3px;
    }
    
    .quest-header p {
      color: #94a3b8;
      font-size: 0.9rem;
      max-width: 700px;
      margin: 0 auto;
      line-height: 1.5;
      opacity: 0.9;
    }
    
    /* ä¸»å®¹å™¨å¸ƒå±€ */
    .quest-main-container {
      display: grid;
      grid-template-columns: 380px 1fr;
      gap: 2.5rem;
      margin-bottom: 2rem;
      margin-top: 0.5rem;
    }
    
    /* å·¦ä¾§æ—¥æœŸè®°å½•åŒºåŸŸ */
    .date-history-container {
      background: linear-gradient(145deg, #1a2030, #0f1420);
      border-radius: 20px;
      padding: 1.2rem;
      border: 1px solid rgba(59, 130, 246, 0.12);
      box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(255, 255, 255, 0.05);
      height: 580px;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }
    
    .date-history-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.3), transparent);
    }
    
    .date-history-header {
      padding-bottom: 0.8rem;
      margin-bottom: 0.8rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .date-history-header h3 {
      color: #0ee7ff;
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .date-history-header h3::before {
      content: 'ğŸ“Š';
      font-size: 1rem;
    }
    
    /* æ—¥æœŸåˆ—è¡¨å®¹å™¨ */
    .date-list-container {
      flex: 1;
      overflow-y: auto;
      padding-right: 6px;
    }
    
    /* æ»šåŠ¨æ¡æ ·å¼ */
    .date-list-container::-webkit-scrollbar {
      width: 6px;
    }
    
    .date-list-container::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.03);
      border-radius: 3px;
    }
    
    .date-list-container::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #3eb489, #3b82f6);
      border-radius: 3px;
    }
    
    /* å•ä¸ªæ—¥æœŸè®°å½•é¡¹ */
    .date-history-item {
      padding: 0.8rem;
      margin-bottom: 0.6rem;
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.6), rgba(15, 23, 42, 0.8));
      border-radius: 10px;
      border-left: 3px solid #3b82f6;
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .date-history-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.05),
        transparent
      );
      transition: left 0.5s ease;
    }
    
    .date-history-item:hover {
      transform: translateX(4px) translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      border-color: rgba(59, 130, 246, 0.3);
    }
    
    .date-history-item:hover::before {
      left: 100%;
    }
    
    .date-history-item.active {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.25), rgba(30, 41, 59, 0.8));
      border-left-color: #3b82f6;
      border-color: rgba(59, 130, 246, 0.4);
      box-shadow: 
        0 0 12px rgba(59, 130, 246, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    .date-history-item.passed {
      border-left-color: #10b981;
    }
    
    .date-history-item.failed {
      border-left-color: #ef4444;
    }
    
    .date-history-item.patience {
      border-left-color: #f59e0b;
    }
    
    .date-history-date {
      font-weight: 600;
      color: #e2e8f0;
      margin-bottom: 3px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .date-history-date::before {
      content: 'ğŸ“…';
      font-size: 0.8rem;
      opacity: 0.7;
    }
    
    .date-history-status {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.8rem;
    }
    
    .status-passed {
      color: #10b981;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .status-failed {
      color: #ef4444;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .status-patience {
      color: #f59e0b;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .status-icon {
      font-size: 0.85rem;
    }
    
    /* ä¸“ä¸šå¡ç‰‡å®¹å™¨ */
    .professional-card {
      background: linear-gradient(145deg, #0f172a, #1e293b);
      border-radius: 18px;
      padding: 1.5rem;
      position: relative;
      border: 1px solid rgba(59, 130, 246, 0.12);
      box-shadow: 
        0 15px 30px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(255, 255, 255, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      overflow: hidden;
      min-height: 580px;
      display: flex;
      flex-direction: column;
      animation: cardEntry 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    @keyframes cardEntry {
      0% {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    /* å¡ç‰‡é¡¶éƒ¨è£…é¥°çº¿ */
    .card-header-decoration {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 70%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 0.8rem;
    }
    
    .decoration-line {
      flex: 1;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.4), transparent);
    }
    
    .decoration-dot {
      width: 6px;
      height: 6px;
      background: linear-gradient(135deg, #3eb489, #3b82f6);
      border-radius: 50%;
      margin: 0 0.8rem;
      box-shadow: 0 0 8px #3b82f6;
      animation: pulseDot 2s ease-in-out infinite;
    }
    
    @keyframes pulseDot {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
    }
    
    /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
    .status-indicator-wrapper {
      display: flex;
      justify-content: center;
      margin-bottom: 1.2rem;
      margin-top: 0.5rem;
    }
    
    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 0.6rem 1.2rem;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.1));
      border-radius: 40px;
      border: 1px solid rgba(245, 158, 11, 0.3);
      backdrop-filter: blur(12px);
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.15);
    }
    
    .status-pill.passed {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
      border-color: rgba(16, 185, 129, 0.3);
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.15);
    }
    
    .status-pill.failed {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
      border-color: rgba(239, 68, 68, 0.3);
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.15);
    }
    
    .status-pill.no-trades {
      background: linear-gradient(135deg, rgba(148, 163, 184, 0.2), rgba(148, 163, 184, 0.1));
      border-color: rgba(148, 163, 184, 0.3);
    }
    
    .status-icon {
      font-size: 1rem;
    }
    
    .status-text {
      font-size: 0.9rem;
      font-weight: 600;
      color: #f59e0b;
    }
    
    .status-pill.passed .status-text {
      color: #10b981;
    }
    
    .status-pill.failed .status-text {
      color: #ef4444;
    }
    
    .status-pill.no-trades .status-text {
      color: #94a3b8;
    }
    
    /* æ•°æ®å¡ç‰‡å®¹å™¨ */
    .card-footer-summary {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      padding: 1rem;
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.5), rgba(15, 23, 42, 0.8));
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      margin-bottom: 1.2rem;
      margin-top: 0.5rem;
      backdrop-filter: blur(10px);
    }
    
    .summary-item {
      text-align: center;
      position: relative;
      padding: 0 0.8rem;
    }
    
    .summary-item:not(:last-child)::after {
      content: '';
      position: absolute;
      top: 50%;
      right: -0.6rem;
      transform: translateY(-50%);
      width: 1px;
      height: 20px;
      background: rgba(255, 255, 255, 0.08);
    }
    
    .summary-label {
      color: #64748b;
      font-size: 0.75rem;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      font-weight: 600;
    }
    
    .summary-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: #e2e8f0;
      line-height: 1;
    }
    
    .summary-value.positive {
      color: #0ee7ff;
    }
    
    .summary-value.negative {
      color: #ef4444;
    }
    
    /* å¡ç‰‡ä¸»æ ‡é¢˜ */
    .card-main-title {
      text-align: center;
      margin-bottom: 1.2rem;
      margin-top: 0.3rem;
      font-size: 1.2rem;
      color: #e2e8f0;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      letter-spacing: -0.3px;
    }
    
    .title-icon {
      font-size: 1.1rem;
      background: linear-gradient(135deg, #3eb489, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* é«˜çº§ç›®æ ‡å¡ç‰‡å®¹å™¨ */
    .premium-targets {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-top: 0.5rem;
    }
    
    /* å•ä¸ªé«˜çº§å¡ç‰‡ */
    .premium-card {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      border-radius: 16px;
      padding: 1.3rem;
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 
        0 10px 25px rgba(0, 0, 0, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .premium-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 30% 20%, rgba(59, 130, 246, 0.08), transparent 50%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .premium-card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.35),
        0 0 30px rgba(59, 130, 246, 0.12);
      border-color: rgba(59, 130, 246, 0.25);
    }
    
    .premium-card:hover::before {
      opacity: 1;
    }
    
    /* å¡ç‰‡è§’è½è£…é¥° */
    .card-corner-decoration {
      position: absolute;
      width: 35px;
      height: 35px;
      border: 2px solid transparent;
    }
    
    .card-corner-decoration.top-left {
      top: 0;
      left: 0;
      border-top-color: rgba(59, 130, 246, 0.3);
      border-left-color: rgba(59, 130, 246, 0.3);
      border-radius: 16px 0 0 0;
    }
    
    .card-corner-decoration.bottom-right {
      bottom: 0;
      right: 0;
      border-bottom-color: rgba(59, 130, 246, 0.3);
      border-right-color: rgba(59, 130, 246, 0.3);
      border-radius: 0 0 16px 0;
    }
    
    /* å¡ç‰‡å¤´éƒ¨ */
    .card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 0.8rem;
    }
    
    .card-title-icon {
      font-size: 1.3rem;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(59, 130, 246, 0.12);
      border-radius: 10px;
      border: 1px solid rgba(59, 130, 246, 0.2);
    }
    
    .profit-icon {
      background: rgba(14, 231, 255, 0.12);
      border-color: rgba(14, 231, 255, 0.25);
      color: #0ee7ff;
    }
    
    .loss-icon {
      background: rgba(239, 68, 68, 0.12);
      border-color: rgba(239, 68, 68, 0.25);
      color: #ef4444;
    }
    
    .card-header h4 {
      color: #94a3b8;
      font-size: 0.9rem;
      margin: 0;
      font-weight: 600;
      letter-spacing: 0.3px;
    }
    
    /* ç›®æ ‡çŠ¶æ€æŒ‡ç¤ºå™¨ */
    .target-status-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 0.8rem;
    }
    
    .target-status-item {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 0.5rem 0.8rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      font-size: 0.8rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    .target-status-item.profit {
      color: #0ee7ff;
      background: rgba(14, 231, 255, 0.1);
      border: 1px solid rgba(14, 231, 255, 0.2);
    }
    
    .target-status-item.loss {
      color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }
    
    .target-status-item.achieved {
      color: #10b981;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }
    
    .target-status-indicator {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      font-size: 0.7rem;
      margin-left: 4px;
    }
    
    .status-check {
      color: #10b981;
      background: rgba(16, 185, 129, 0.2);
      animation: pulseSuccess 2s infinite;
    }
    
    .status-cross {
      color: #ef4444;
      background: rgba(239, 68, 68, 0.2);
      animation: pulseError 2s infinite;
    }
    
    @keyframes pulseSuccess {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    @keyframes pulseError {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    /* ç›®æ ‡å€¼æ˜¾ç¤º */
    .premium-value {
      font-size: 1.7rem;
      font-weight: 700;
      margin-bottom: 0.8rem;
      display: flex;
      align-items: baseline;
      justify-content: center;
      gap: 5px;
      line-height: 1;
    }
    
    .premium-value .current {
      color: #0ee7ff;
      text-shadow: 0 2px 6px rgba(14, 231, 255, 0.2);
    }
    
    .premium-value.loss .current {
      color: #ef4444;
      text-shadow: 0 2px 6px rgba(239, 68, 68, 0.2);
    }
    
    .premium-value .separator {
      color: #64748b;
      margin: 0 4px;
      font-weight: 500;
    }
    
    .premium-value .target {
      color: #cbd5e1;
      font-weight: 500;
      opacity: 0.9;
    }
    
    .premium-value .currency {
      font-size: 0.85rem;
      color: #94a3b8;
      margin-left: 6px;
      font-weight: 500;
    }
    
    /* è¿›åº¦æ¡éƒ¨åˆ† */
    .progress-section {
      margin-bottom: 0.8rem;
    }
    
    .progress-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    
    .progress-label .percentage {
      font-size: 1rem;
      font-weight: 700;
      color: #e2e8f0;
    }
    
    .progress-label .progress-desc {
      font-size: 0.75rem;
      color: #64748b;
      text-align: right;
      max-width: 110px;
    }
    
    /* è¿›åº¦æ¡åŒ…è£…å™¨ */
    .progress-bar-wrapper {
      position: relative;
      height: 10px;
    }
    
    .progress-bar-bg {
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 5px;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
    }
    
    .progress-bar-fill {
      height: 100%;
      border-radius: 5px;
      position: relative;
      background: linear-gradient(90deg, #0ee7ff, #06b6d4, #0891b2);
      width: 0%;
      transition: width 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 0 12px rgba(14, 231, 255, 0.25);
    }
    
    .progress-bar-fill.loss {
      background: linear-gradient(90deg, #ef4444, #dc2626, #b91c1c);
      box-shadow: 0 0 12px rgba(239, 68, 68, 0.25);
    }
    
    .progress-bar-glow {
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      animation: glowMove 2.5s linear infinite;
    }
    
    /* ç»Ÿè®¡å¾½ç«  */
    .stats-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 0.4rem 0.8rem;
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.9));
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(8px);
    }
    
    .profit-stats {
      border-color: rgba(14, 231, 255, 0.2);
      box-shadow: 0 3px 10px rgba(14, 231, 255, 0.08);
    }
    
    .loss-stats {
      border-color: rgba(239, 68, 68, 0.2);
      box-shadow: 0 3px 10px rgba(239, 68, 68, 0.08);
    }
    
    .stats-icon {
      font-size: 0.8rem;
    }
    
    .stats-text {
      font-size: 0.8rem;
      color: #94a3b8;
      font-weight: 500;
    }
    
    /* ç©ºçŠ¶æ€æç¤º */
    .empty-history {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #64748b;
      text-align: center;
      padding: 2rem;
    }
    
    .empty-history::before {
      content: 'ğŸ“Š';
      font-size: 2.5rem;
      margin-bottom: 1rem;
      opacity: 0.5;
      animation: float 3s ease-in-out infinite;
    }
    
    /* æˆå°±å¾½ç«  */
    .achievement-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: linear-gradient(135deg, #f59e0b, #f97316);
      color: white;
      padding: 4px 10px;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: bold;
      animation: pulse 2s infinite;
      z-index: 2;
      box-shadow: 0 3px 10px rgba(245, 158, 11, 0.25);
    }
    
    .achievement-badge::before {
      content: 'ğŸ†';
      margin-right: 4px;
    }
    
    /* èƒŒæ™¯è£…é¥° */
    .professional-card::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      right: -50%;
      bottom: -50%;
      background: radial-gradient(circle at 30% 30%, rgba(59, 130, 246, 0.03), transparent 50%),
                  radial-gradient(circle at 70% 70%, rgba(62, 180, 137, 0.03), transparent 50%);
      pointer-events: none;
      z-index: 0;
      animation: rotate 20s linear infinite;
    }
    
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .professional-card > * {
      position: relative;
      z-index: 1;
    }
    
    /* å®ŒæˆåŠ¨ç”» */
    @keyframes completeAnimation {
      0% {
        transform: scale(1);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 20px 40px rgba(16, 185, 129, 0.25);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
      }
    }
    
    .quest-complete {
      animation: completeAnimation 0.6s ease;
    }
    
    /* ç›ˆäºæŒ‡ç¤ºå™¨ */
    .pnl-indicator {
      font-size: 0.85rem;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.05);
    }
    
    .pnl-indicator.positive {
      color: #10b981;
      background: rgba(16, 185, 129, 0.1);
    }
    
    .pnl-indicator.negative {
      color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 1200px) {
      .quest-main-container {
        grid-template-columns: 340px 1fr;
        gap: 2rem;
      }
      
      .professional-card {
        padding: 1.3rem;
      }
      
      .premium-targets {
        gap: 1.2rem;
      }
      
      .premium-value {
        font-size: 1.5rem;
      }
      
      .date-history-container {
        height: 540px;
      }
    }
    
    @media (max-width: 992px) {
      .quest-main-container {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      
      .date-history-container {
        height: 320px;
      }
      
      .professional-card {
        min-height: auto;
        padding: 1.3rem;
      }
      
      .card-footer-summary {
        grid-template-columns: 1fr;
        gap: 0.8rem;
        padding: 0.9rem;
      }
      
      .summary-item:not(:last-child)::after {
        display: none;
      }
      
      .summary-item {
        padding: 0.6rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }
      
      .summary-item:last-child {
        border-bottom: none;
      }
      
      .premium-targets {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    }
    
    @media (max-width: 768px) {
      .quest-container {
        padding: 0 1rem;
      }
      
      .quest-header {
        padding: 1.2rem;
        margin-bottom: 1.2rem;
      }
      
      .quest-header h1 {
        font-size: 1.6rem;
      }
      
      .premium-targets {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .premium-card {
        padding: 1.1rem;
      }
      
      .premium-value {
        font-size: 1.4rem;
      }
      
      .date-badge {
        padding: 0.5rem 1.2rem;
      }
      
      #selectedDateValue {
        font-size: 1rem;
      }
      
      .status-pill {
        padding: 0.5rem 1rem;
      }
      
      .professional-card {
        padding: 1.1rem;
      }
      
      .card-main-title {
        font-size: 1.1rem;
        margin-bottom: 1rem;
      }
      
      .summary-value {
        font-size: 1.1rem;
      }
    }
    
    @media (max-width: 480px) {
      .quest-header h1 {
        font-size: 1.4rem;
      }
      
      .quest-header p {
        font-size: 0.85rem;
      }
      
      .date-history-container {
        padding: 1rem;
      }
      
      .professional-card {
        padding: 1rem;
      }
      
      .premium-value {
        font-size: 1.2rem;
      }
      
      .summary-value {
        font-size: 1rem;
      }
      
      .card-main-title {
        font-size: 1rem;
        margin-bottom: 0.8rem;
      }
      
      .progress-label .percentage {
        font-size: 0.9rem;
      }
      
      .card-footer-summary {
        padding: 0.8rem;
      }
      
      .summary-label {
        font-size: 0.7rem;
      }
      
      .target-status-item {
        font-size: 0.75rem;
        padding: 0.4rem 0.6rem;
      }
    }
    
    /* æ€§èƒ½ä¼˜åŒ– */
    @media (prefers-reduced-motion: reduce) {
      .professional-card,
      .premium-card,
      .date-history-item,
      .progress-bar-fill {
        transition: none !important;
        animation: none !important;
      }
      
      .progress-bar-fill {
        transition: width 0.3s ease !important;
      }
      
      .status-check,
      .status-cross {
        animation: none !important;
      }
    }
    
    /* é«˜å¯¹æ¯”åº¦æ¨¡å¼ */
    @media (prefers-contrast: high) {
      .professional-card,
      .premium-card,
      .date-history-item {
        border: 2px solid #3b82f6;
      }
      
      .progress-bar-fill {
        border: 1px solid white;
      }
      
      .status-pill {
        border: 2px solid currentColor;
      }
      
      .target-status-item {
        border: 2px solid currentColor;
      }
    }
    
    /* æ·±è‰²æ¨¡å¼ä¼˜åŒ– */
    @media (prefers-color-scheme: dark) {
      .professional-card,
      .premium-card,
      .date-history-container {
        background: linear-gradient(145deg, #0a0e1a, #121828);
      }
    }
  </style>
</head>
<body>
  <!-- ä¾§è¾¹æ  -->
  <nav id="sidebar" class="sidebar">
    <ul>
      <li><a href="index.html" data-i18n="dashboard">Dashboard</a></li>
      <li><a href="quest.html" data-i18n="daily_quest" class="active">Daily Quest</a></li>
      <li><a href="reports.html" data-i18n="reports">Reports</a></li>
      <li><a href="settings.html" data-i18n="settings">Settings</a></li>
    </ul>
  </nav>

  <!-- ä¸»å†…å®¹ -->
  <div id="pageContent" class="page-content">
    <header>
      <button id="hamburgerBtn" class="hamburger-btn">â˜°</button>
      <h1 data-i18n="daily_quest">Daily Quest</h1>
    </header>

    <main>
      <div class="quest-container">
        <!-- é¡µé¢æ ‡é¢˜åŒºåŸŸ -->
        <div class="quest-header">
          <h1 data-i18n="daily_quest_title">Daily Trading Challenges</h1>
          <p data-i18n="quest_desc">Track your daily performance, achieve targets, and maintain trading discipline. Every day is a new opportunity.</p>
        </div>

        <!-- ç»Ÿè®¡æ‘˜è¦ -->
        <div class="stats-summary" id="statsSummary" style="margin-bottom: 2rem;">
          <!-- ç»Ÿè®¡å¡ç‰‡å°†ç”± JavaScript åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- ä¸»å®¹å™¨ - å·¦ä¾§æ—¥æœŸè®°å½• + å³ä¾§å½“æ—¥å¡ç‰‡ -->
        <div class="quest-main-container">
          <!-- å·¦ä¾§æ—¥æœŸè®°å½• -->
          <div class="date-history-container">
            <div class="date-history-header">
              <h3 data-i18n="history_records">Trading History</h3>
            </div>
            <div class="date-list-container" id="dateHistoryList">
              <!-- æ—¥æœŸè®°å½•å°†åŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
              <div class="empty-history" id="emptyHistory">
                <p data-i18n="no_history_yet">No trading records yet</p>
                <p class="empty-hint" data-i18n="start_trading_hint">Start trading to see your daily performance here</p>
              </div>
            </div>
          </div>
          
          <!-- å³ä¾§ä¸“ä¸šå¡ç‰‡ -->
<div class="professional-card">
  <!-- å¡ç‰‡é¡¶éƒ¨è£…é¥°çº¿ -->
  <div class="card-header-decoration">
    <div class="decoration-line"></div>
    <div class="decoration-dot"></div>
    <div class="decoration-line"></div>
  </div>
  
  <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
  <div class="status-indicator-wrapper">
    <div class="status-pill" id="statusPill">
      <span class="status-icon">â³</span>
      <span class="status-text" id="statusText">Patience</span>
    </div>
  </div>
  
  <!-- æ•°æ®å¡ç‰‡ -->
  <div class="card-footer-summary">
  <div class="summary-item">
    <div class="summary-label" data-i18n="daily_result">Daily Result</div>
    <div class="summary-value" id="dailyResult">$0.00</div>
  </div>
  <div class="summary-item">
    <div class="summary-label" data-i18n="trades_today">Trades</div>
    <div class="summary-value" id="tradesCount">0</div>
  </div>
  <div class="summary-item">
    <div class="summary-label" data-i18n="profit_factor">Profit Factor</div>
    <div class="summary-value" id="profitFactor">0.0</div>
  </div>
</div>
  
  <!-- å¡ç‰‡ä¸»æ ‡é¢˜ -->
  <h3 class="card-main-title">
    <span class="title-icon">ğŸ“Š</span>
    <span data-i18n="trading_status">Trading Performance</span>
  </h3>
  
  <!-- ç›®æ ‡å®¹å™¨ -->
  <div class="premium-targets">
    <!-- ç›ˆåˆ©ç›®æ ‡å¡ç‰‡ -->
    <div class="premium-card profit-target-card">
      <div class="card-corner-decoration top-left"></div>
      <div class="card-corner-decoration bottom-right"></div>
      
      <!-- æˆå°±å¾½ç«  -->
      <div class="achievement-badge" id="profitBadge" style="display: none;">Goal Achieved</div>
      
      <div class="card-header">
        <div class="card-title-icon profit-icon">ğŸ’°</div>
        <h4 data-i18n="daily_profit_target">Profit Target</h4>
      </div>
      
      <div class="card-content">
        <div class="target-value premium-value" id="profitTarget">
          <span class="current" id="profitCurrent">0</span>
          <span class="separator">/</span>
          <span class="target" id="profitTargetValue">100</span>
          <span class="currency">USD</span>
        </div>
        
        <div class="progress-section">
          <div class="progress-label">
            <span class="percentage" id="profitPercentage">0%</span>
            <span class="progress-desc" id="profitTargetDesc">of daily balance</span>
          </div>
          <div class="progress-bar-wrapper">
            <div class="progress-bar-bg">
              <div class="progress-bar-fill" id="profitProgress"></div>
              <div class="progress-bar-glow"></div>
            </div>
          </div>
        </div>
        
        <!-- ç›ˆåˆ©ç›®æ ‡çŠ¶æ€ -->
        <div class="target-status-container" id="profitTargetStatusContainer" style="display: none;">
          <div class="target-status-item profit" id="profitTargetStatus">
            <span>ğŸ“ˆ 10% daily profit target</span>
            <span class="target-status-indicator" id="profitStatusIndicator"></span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- äºæŸé™åˆ¶å¡ç‰‡ -->
    <div class="premium-card loss-limit-card">
      <div class="card-corner-decoration top-left"></div>
      <div class="card-corner-decoration bottom-right"></div>
      
      <div class="card-header">
        <div class="card-title-icon loss-icon">ğŸ›¡ï¸</div>
        <h4 data-i18n="daily_loss_limit">Loss Limit</h4>
      </div>
      
      <div class="card-content">
        <div class="target-value premium-value loss" id="lossLimit">
          <span class="current" id="lossCurrent">0</span>
          <span class="separator">/</span>
          <span class="target" id="lossLimitValue">250</span>
          <span class="currency">USD</span>
        </div>
        
        <div class="progress-section">
          <div class="progress-label">
            <span class="percentage" id="lossPercentage">0%</span>
            <span class="progress-desc" id="lossLimitDesc">of daily balance</span>
          </div>
          <div class="progress-bar-wrapper">
            <div class="progress-bar-bg">
              <div class="progress-bar-fill loss" id="lossProgress"></div>
              <div class="progress-bar-glow"></div>
            </div>
          </div>
        </div>
        
        <!-- äºæŸé™åˆ¶çŠ¶æ€ -->
        <div class="target-status-container" id="lossTargetStatusContainer" style="display: none;">
          <div class="target-status-item loss" id="lossTargetStatus">
            <span>ğŸ“‰ 25% daily loss limit</span>
            <span class="target-status-indicator" id="lossStatusIndicator"></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
        </div>
      </div>
    </main>
  </div>

  <!-- å¼•å…¥è„šæœ¬ -->
  <script src="language.js"></script>
  
  <!-- é¡µé¢è„šæœ¬ -->
  <script>
  // é¦–å…ˆç¡®ä¿ç¿»è¯‘å¯¹è±¡å­˜åœ¨
  if (!window.translations) {
    window.translations = {};
  }
  
  // ç¡®ä¿è‹±æ–‡ç¿»è¯‘å­˜åœ¨
  if (!window.translations.en) {
    window.translations.en = {};
  }
  
  // ç¡®ä¿ä¸­æ–‡ç¿»è¯‘å­˜åœ¨
  if (!window.translations.zh) {
    window.translations.zh = {};
  }
  
  // æ·»åŠ æ‰€æœ‰ç¿»è¯‘é”®
  const translationKeys = {
    en: {
      profit_factor: "Profit Factor",
      daily_quest_title: "Daily Trading Challenges",
      quest_desc: "Track your daily performance, achieve targets, and maintain trading discipline. Every day is a new opportunity.",
      history_records: "Trading History",
      no_history_yet: "No trading records yet",
      start_trading_hint: "Start trading to see your daily performance here",
      trading_status: "Trading Performance",
      passed: "Passed",
      failed: "Failed",
      patience: "Patience",
      no_trades: "No Trades",
      daily_profit_target: "Profit Target",
      daily_loss_limit: "Loss Limit",
      daily_result: "Daily Result",
      trades_today: "Trades",
      risk_ratio: "Risk Ratio",
      achievement_goal: "Goal Achieved",
      total_profit: "Total Profit",
      total_trades: "Total Trades",
      win_rate: "Win Rate",
      avg_profit: "Avg. Profit",
      max_profit: "Max Profit",
      max_loss: "Max Loss",
      consistency: "Consistency",
      current_streak: "Current Streak",
      profit_target_status: "10% daily profit target",
      loss_limit_status: "25% daily loss limit"
    },
    zh: {
      profit_factor: "ç›ˆåˆ©å› å­",
      daily_quest_title: "æ¯æ—¥äº¤æ˜“æŒ‘æˆ˜",
      quest_desc: "è·Ÿè¸ªæ‚¨çš„æ¯æ—¥è¡¨ç°ï¼Œå®ç°ç›®æ ‡ï¼Œå¹¶ä¿æŒäº¤æ˜“çºªå¾‹ã€‚æ¯ä¸€å¤©éƒ½æ˜¯æ–°çš„æœºä¼šã€‚",
      history_records: "äº¤æ˜“å†å²",
      no_history_yet: "æš‚æ— äº¤æ˜“è®°å½•",
      start_trading_hint: "å¼€å§‹äº¤æ˜“ä»¥æŸ¥çœ‹æ¯æ—¥è¡¨ç°",
      trading_status: "äº¤æ˜“è¡¨ç°",
      passed: "å·²é€šè¿‡",
      failed: "å·²å¤±è´¥",
      patience: "éœ€è€å¿ƒ",
      no_trades: "æ— äº¤æ˜“",
      daily_profit_target: "ç›ˆåˆ©ç›®æ ‡",
      daily_loss_limit: "äºæŸé™åˆ¶",
      daily_result: "å½“æ—¥ç»“æœ",
      trades_today: "äº¤æ˜“æ¬¡æ•°",
      risk_ratio: "é£é™©æ¯”ç‡",
      achievement_goal: "ç›®æ ‡è¾¾æˆ",
      total_profit: "æ€»ç›ˆåˆ©",
      total_trades: "æ€»äº¤æ˜“",
      win_rate: "èƒœç‡",
      avg_profit: "å¹³å‡ç›ˆåˆ©",
      max_profit: "æœ€å¤§ç›ˆåˆ©",
      max_loss: "æœ€å¤§äºæŸ",
      consistency: "ä¸€è‡´æ€§",
      current_streak: "å½“å‰è¿èƒœ",
      profit_target_status: "10% æ¯æ—¥ç›ˆåˆ©ç›®æ ‡",
      loss_limit_status: "25% æ¯æ—¥äºæŸé™åˆ¶"
    }
  };
  
  // åˆå¹¶ç¿»è¯‘
  Object.assign(window.translations.en, translationKeys.en);
  Object.assign(window.translations.zh, translationKeys.zh);

    // Supabase é…ç½®
    const SUPABASE_URL = "https://qwcfxuwerdpadntjxwvo.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3Y2Z4dXdlcmRwYWRudGp4d3ZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxNDQyNjcsImV4cCI6MjA4MzcyMDI2N30.5kMmJwYQQ0vugPplzXhHjeG2C3QB5CQZ39p57WQv1ag";
    const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    
    // å…¨å±€å˜é‡
    let currentUserId = null;
    let dateHistoryData = {};
    let selectedDate = null;
    let dateRange = [];
    
    // ç¼“å­˜ç®¡ç†
    const dateDataCache = new Map();
    const CACHE_DURATION = 5 * 60 * 1000;
    
    // æ±‰å ¡èœå•
    const sidebar = document.getElementById("sidebar");
    const pageContent = document.getElementById("pageContent");
    const hamburgerBtn = document.getElementById("hamburgerBtn");
    
    if (hamburgerBtn) {
      hamburgerBtn.addEventListener("click", () => {
        sidebar.classList.toggle("show");
        pageContent.classList.toggle("shift");
      });
    }
    
    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    async function checkAuth() {
      const { data: { session }, error } = await client.auth.getSession();
      
      if (!session) {
        window.location.href = 'login.html';
        return null;
      }
      
      currentUserId = session.user.id;
      return session;
    }

    // ç”Ÿæˆè¿ç»­çš„æ—¥æœŸåˆ—è¡¨
    function generateDateRange(days = 7) {
      const dates = [];
      const today = new Date();
      
      for (let i = days - 1; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        dates.push(dateStr);
      }
      
      return dates;
    }

    // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
    function formatDateForDisplay(dateStr, lang = 'en') {
      const date = new Date(dateStr);
      
      if (lang === 'zh') {
        return `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
      } else {
        const day = date.getDate();
        const month = date.toLocaleDateString('en-US', { month: 'short' });
        const year = date.getFullYear();
        return `${day} ${month} ${year}`;
      }
    }

    // è®¡ç®—æ—¥æœŸçŠ¶æ€
    function calculateDateStatus(totalPnl, profitTarget, lossLimit) {
      if (Math.abs(totalPnl) >= lossLimit && totalPnl < 0) {
        return { status: 'failed', statusClass: 'failed' };
      } else if (totalPnl >= profitTarget) {
        return { status: 'passed', statusClass: 'passed' };
      } else {
        return { status: 'patience', statusClass: 'patience' };
      }
    }

    // è·å–æŒ‡å®šæ—¥æœŸçš„èµ·å§‹ä½™é¢
    async function getDateStartingBalance(userId, targetDate) {
      try {
        const { currentBalance, dailyBalances } = await getBalanceByDate(userId);
        
        const targetDateObj = new Date(targetDate);
        const previousDay = new Date(targetDateObj);
        previousDay.setDate(previousDay.getDate() - 1);
        const previousDayStr = previousDay.toISOString().split('T')[0];
        
        let startingBalance = 1000;
        
        if (dailyBalances[previousDayStr]) {
          startingBalance = dailyBalances[previousDayStr];
        } else if (Object.keys(dailyBalances).length > 0) {
          const dates = Object.keys(dailyBalances).sort();
          let foundBalance = null;
          
          for (let i = dates.length - 1; i >= 0; i--) {
            if (dates[i] < targetDate) {
              foundBalance = dailyBalances[dates[i]];
              break;
            }
          }
          
          if (foundBalance) {
            startingBalance = foundBalance;
          }
        }
        
        if (startingBalance <= 0) {
          startingBalance = 1000;
        }
        
        return startingBalance;
        
      } catch (error) {
        console.error('Error getting date starting balance:', error);
        return 1000;
      }
    }

    // æŒ‰æ—¥æœŸè®¡ç®—æ¯æ—¥ç»“æŸæ—¶çš„ä½™é¢
    async function getBalanceByDate(userId) {
      const cacheKey = `balance_${userId}`;
      const cached = dateDataCache.get(cacheKey);
      
      if (cached && (Date.now() - cached.timestamp < CACHE_DURATION)) {
        return cached.data;
      }
      
      try {
        const { data: trades, error } = await client
          .from('trades')
          .select('date, pnl_amount, balance_change, direction')
          .eq('user_id', userId)
          .order('date', { ascending: true })
          .order('created_at', { ascending: true });
        
        if (error) throw error;
        
        if (!trades || trades.length === 0) {
          const result = { currentBalance: 1000, dailyBalances: {} };
          dateDataCache.set(cacheKey, { data: result, timestamp: Date.now() });
          return result;
        }
        
        const dailyBalances = {};
        let currentBalance = 0;
        
        trades.forEach(trade => {
          const date = trade.date;
          
          let change = 0;
          if (trade.direction === "Deposit" || trade.direction === "Withdrawal") {
            change = parseFloat(trade.balance_change || 0);
          } else {
            change = parseFloat(trade.pnl_amount || 0);
          }
          
          currentBalance += change;
          dailyBalances[date] = currentBalance;
        });
        
        const result = { currentBalance, dailyBalances };
        dateDataCache.set(cacheKey, { data: result, timestamp: Date.now() });
        return result;
        
      } catch (error) {
        console.error('Error getting balance by date:', error);
        return { currentBalance: 1000, dailyBalances: {} };
      }
    }

    // è·å–æ—¥æœŸç»Ÿè®¡ - ä¿®æ”¹ç‰ˆæœ¬ï¼ˆåŒ…å«ç›ˆåˆ©å› å­è®¡ç®—æ‰€éœ€æ•°æ®ï¼‰
async function getDateStats(userId, date) {
  try {
    const { data: trades, error } = await client
      .from('trades')
      .select('id, pnl_amount, direction')
      .eq('user_id', userId)
      .eq('date', date);
    
    if (error) throw error;
    
    let tradeCount = 0;
    let winCount = 0;
    let totalProfit = 0;
    let totalWinningProfit = 0; // æ–°å¢ï¼šç›ˆåˆ©æ€»é¢
    let totalLosingLoss = 0;     // æ–°å¢ï¼šäºæŸæ€»é¢ï¼ˆæ­£æ•°ï¼‰
    let maxProfit = 0;
    let maxLoss = 0;
    
    if (trades && trades.length > 0) {
      trades.forEach(trade => {
        if (trade.direction === 'Buy' || trade.direction === 'Sell') {
          const pnl = parseFloat(trade.pnl_amount || 0);
          tradeCount++;
          totalProfit += pnl;
          
          if (pnl > 0) {
            winCount++;
            totalWinningProfit += pnl; // ç´¯åŠ ç›ˆåˆ©
          } else if (pnl < 0) {
            totalLosingLoss += Math.abs(pnl); // ç´¯åŠ äºæŸï¼ˆè½¬ä¸ºæ­£æ•°ï¼‰
          }
          
          if (pnl > maxProfit) maxProfit = pnl;
          if (pnl < maxLoss) maxLoss = pnl;
        }
      });
    }
    
    // è®¡ç®—ç›ˆåˆ©å› å­
    let profitFactor = 0;
    if (totalLosingLoss > 0) {
      profitFactor = totalWinningProfit / totalLosingLoss;
    } else if (totalWinningProfit > 0) {
      profitFactor = 99.9; // åªæœ‰ç›ˆåˆ©ï¼Œæ²¡æœ‰äºæŸ
    }
    // å¦‚æœ totalWinningProfit å’Œ totalLosingLoss éƒ½æ˜¯ 0ï¼ŒprofitFactor ä¿æŒ 0
    
    return {
      tradeCount,
      winCount,
      totalProfit,
      totalWinningProfit, // è¿”å›ç›ˆåˆ©æ€»é¢
      totalLosingLoss,    // è¿”å›äºæŸæ€»é¢
      profitFactor,       // è¿”å›è®¡ç®—å¥½çš„ç›ˆåˆ©å› å­
      maxProfit,
      maxLoss,
      winRate: tradeCount > 0 ? (winCount / tradeCount) * 100 : 0,
      avgProfit: tradeCount > 0 ? totalProfit / tradeCount : 0
    };
    
  } catch (error) {
    console.error('Error getting date stats:', error);
    return {
      tradeCount: 0,
      winCount: 0,
      totalProfit: 0,
      totalWinningProfit: 0,
      totalLosingLoss: 0,
      profitFactor: 0,
      maxProfit: 0,
      maxLoss: 0,
      winRate: 0,
      avgProfit: 0
    };
  }
}

    // åŠ è½½æ‰€æœ‰æ—¥æœŸè®°å½•
    async function loadAllDateRecords(userId) {
      try {
        const emptyHistoryEl = document.getElementById('emptyHistory');
        const dateHistoryList = document.getElementById('dateHistoryList');
        
        if (!emptyHistoryEl || !dateHistoryList) return;
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        dateHistoryList.innerHTML = `
          <div class="loading-spinner">
            <div class="spinner"></div>
            <div class="spinner-text">Loading trading history...</div>
          </div>
        `;
        
        // è·å–æœ€è¿‘7å¤©çš„æ—¥æœŸ
        dateRange = generateDateRange(7);
        const today = new Date().toISOString().split('T')[0];
        
        const { data: allTrades, error } = await client
          .from('trades')
          .select('date, pnl_amount, balance_change, direction')
          .eq('user_id', userId)
          .in('date', dateRange)
          .order('date', { ascending: false });
        
        if (error) throw error;
        
        // æŒ‰æ—¥æœŸåˆ†ç»„è®¡ç®—ç›ˆäº
        const dateGroups = {};
        if (allTrades && allTrades.length > 0) {
          allTrades.forEach(trade => {
            const date = trade.date;
            if (!dateGroups[date]) {
              dateGroups[date] = { 
                totalPnl: 0, 
                tradeCount: 0,
                deposits: 0,
                withdrawals: 0,
                hasTrades: false
              };
            }
            
            if (trade.direction === 'Deposit') {
              dateGroups[date].deposits += parseFloat(trade.balance_change || 0);
              dateGroups[date].hasTrades = true;
            } else if (trade.direction === 'Withdrawal') {
              dateGroups[date].withdrawals += parseFloat(trade.balance_change || 0);
              dateGroups[date].hasTrades = true;
            } else if (trade.direction === 'Buy' || trade.direction === 'Sell') {
              dateGroups[date].totalPnl += parseFloat(trade.pnl_amount || 0);
              dateGroups[date].tradeCount++;
              dateGroups[date].hasTrades = true;
            }
          });
        }
        
        // ç¡®ä¿æ‰€æœ‰æ—¥æœŸéƒ½æœ‰æ•°æ®å¯¹è±¡
        dateRange.forEach(date => {
          if (!dateGroups[date]) {
            dateGroups[date] = { 
              totalPnl: 0, 
              tradeCount: 0,
              deposits: 0,
              withdrawals: 0,
              hasTrades: false
            };
          }
        });
        
        const { currentBalance, dailyBalances } = await getBalanceByDate(userId);
        
        // æ¸…ç©ºç°æœ‰å†…å®¹
        dateHistoryList.innerHTML = '';
        dateHistoryData = {};
        
        const currentLang = localStorage.getItem('language') || 'en';
        
        // æŒ‰æ—¥æœŸå€’åºå¤„ç†
        const sortedDates = Object.keys(dateGroups).sort((a, b) => b.localeCompare(a));
        
        // ä¸ºæ¯ä¸ªæ—¥æœŸè·å–è¯¦ç»†æ•°æ®
        for (const date of sortedDates) {
          const data = dateGroups[date];
          const totalPnl = data.totalPnl;
          
          const startingBalance = await getDateStartingBalance(userId, date);
          
          const profitTarget = startingBalance * 0.1;
          const lossLimit = startingBalance * 0.25;
          
          let statusInfo;
          if (!data.hasTrades) {
            statusInfo = { status: 'patience', statusClass: 'patience' };
          } else {
            statusInfo = calculateDateStatus(totalPnl, profitTarget, lossLimit);
          }
          
          const stats = await getDateStats(userId, date);
          
          // å­˜å‚¨æ—¥æœŸæ•°æ®
          dateHistoryData[date] = {
            date,
            totalPnl,
            startingBalance,
            profitTarget,
            lossLimit,
            status: statusInfo.status,
            statusClass: statusInfo.statusClass,
            hasTrades: data.hasTrades,
            stats
          };
          
          let statusText = '';
          if (!data.hasTrades) {
            statusText = currentLang === 'zh' ? 'æ— äº¤æ˜“' : 'No Trades';
          } else if (window.translations && window.translations[currentLang] && window.translations[currentLang][statusInfo.status]) {
            statusText = window.translations[currentLang][statusInfo.status];
          } else {
            statusText = statusInfo.status;
          }
          
          const statusIcons = {
            'passed': 'âœ…',
            'failed': 'âŒ',
            'patience': 'â³'
          };
          
          const statusIcon = !data.hasTrades ? 'ğŸ“Š' : (statusIcons[statusInfo.status] || 'â³');
          
          // åˆ›å»ºæ—¥æœŸè®°å½•é¡¹
          const historyItem = document.createElement('div');
          historyItem.className = `date-history-item ${statusInfo.statusClass} ${date === today ? 'active' : ''}`;
          historyItem.dataset.date = date;
          historyItem.dataset.status = statusInfo.status;
          historyItem.dataset.hasTrades = data.hasTrades;
          
          const formattedDate = formatDateForDisplay(date, currentLang);
          
          historyItem.innerHTML = `
            <div class="date-history-date">${formattedDate}</div>
            <div class="date-history-status">
              <span class="status-${statusInfo.statusClass}">
                <span class="status-icon">${statusIcon}</span>
                <span>${statusText}</span>
              </span>
              <span class="pnl-indicator ${totalPnl >= 0 ? 'positive' : 'negative'}">
                ${totalPnl >= 0 ? '+' : ''}${totalPnl.toFixed(2)}
              </span>
            </div>
          `;
          
          historyItem.addEventListener('click', () => {
            selectDate(date);
          });
          
          dateHistoryList.appendChild(historyItem);
        }
        
        if (sortedDates.length === 0) {
          emptyHistoryEl.style.display = 'flex';
          dateHistoryList.innerHTML = '';
          dateHistoryList.appendChild(emptyHistoryEl);
        } else {
          emptyHistoryEl.style.display = 'none';
          
          const defaultDate = sortedDates.includes(today) ? today : sortedDates[0];
          selectDate(defaultDate);
        }
        
        updateStatsSummary();
        
      } catch (error) {
        console.error('Error loading date records:', error);
        const dateHistoryList = document.getElementById('dateHistoryList');
        if (dateHistoryList) {
          dateHistoryList.innerHTML = `
            <div class="empty-history">
              <div class="empty-state-icon">âš ï¸</div>
              <h4>Error Loading Data</h4>
              <p>Failed to load trading history. Please try again later.</p>
            </div>
          `;
        }
      }
    }

    // æ›´æ–°ç›®æ ‡çŠ¶æ€æŒ‡ç¤ºå™¨
    function updateTargetStatusIndicators(dateData) {
      const profitTargetStatusContainer = document.getElementById('profitTargetStatusContainer');
      const lossTargetStatusContainer = document.getElementById('lossTargetStatusContainer');
      const profitStatusIndicator = document.getElementById('profitStatusIndicator');
      const lossStatusIndicator = document.getElementById('lossStatusIndicator');
      const profitTargetStatus = document.getElementById('profitTargetStatus');
      const lossTargetStatus = document.getElementById('lossTargetStatus');
      
      if (!dateData.hasTrades) {
        // æ²¡æœ‰äº¤æ˜“è®°å½•ï¼Œéšè—çŠ¶æ€æŒ‡ç¤ºå™¨
        if (profitTargetStatusContainer) profitTargetStatusContainer.style.display = 'none';
        if (lossTargetStatusContainer) lossTargetStatusContainer.style.display = 'none';
        return;
      }
      
      const currentLang = localStorage.getItem('language') || 'en';
      
      // è®¡ç®—ç›ˆåˆ©ç›®æ ‡çŠ¶æ€
      const profitAchieved = Math.max(0, dateData.totalPnl);
      const profitPercentage = dateData.profitTarget > 0 ? 
        (profitAchieved / dateData.profitTarget) * 100 : 0;
      
      const isProfitTargetMet = profitPercentage >= 100;
      
      // è®¡ç®—äºæŸé™åˆ¶çŠ¶æ€
      const todayLoss = Math.max(0, -dateData.totalPnl);
      const lossPercentage = dateData.lossLimit > 0 ? 
        (todayLoss / dateData.lossLimit) * 100 : 0;
      
      const isLossLimitRespected = lossPercentage < 100;
      
      // æ›´æ–°ç›ˆåˆ©ç›®æ ‡çŠ¶æ€
      if (profitTargetStatusContainer && profitStatusIndicator && profitTargetStatus) {
        profitTargetStatusContainer.style.display = 'flex';
        
        if (isProfitTargetMet) {
          // ç›ˆåˆ©ç›®æ ‡è¾¾æˆ - é’è‰²åœ†å½¢æ‰“å‹¾
          profitStatusIndicator.className = 'target-status-indicator status-check';
          profitStatusIndicator.innerHTML = 'âœ“';
          profitTargetStatus.className = 'target-status-item achieved';
        } else {
          // ç›ˆåˆ©ç›®æ ‡æœªè¾¾æˆ - çº¢è‰²æ‰“å‰
          profitStatusIndicator.className = 'target-status-indicator status-cross';
          profitStatusIndicator.innerHTML = 'âœ—';
          profitTargetStatus.className = 'target-status-item profit';
        }
        
        // æ›´æ–°æ–‡æœ¬
        const profitText = profitTargetStatus.querySelector('span:first-child');
        if (profitText) {
          profitText.innerHTML = `ğŸ“ˆ 10% daily profit target`;
        }
      }
      
      // æ›´æ–°äºæŸé™åˆ¶çŠ¶æ€
      if (lossTargetStatusContainer && lossStatusIndicator && lossTargetStatus) {
        lossTargetStatusContainer.style.display = 'flex';
        
        if (isLossLimitRespected) {
          // äºæŸé™åˆ¶æœªè¶…è¿‡ - é’è‰²åœ†å½¢æ‰“å‹¾
          lossStatusIndicator.className = 'target-status-indicator status-check';
          lossStatusIndicator.innerHTML = 'âœ“';
          lossTargetStatus.className = 'target-status-item achieved';
        } else {
          // äºæŸé™åˆ¶è¶…è¿‡ - çº¢è‰²æ‰“å‰
          lossStatusIndicator.className = 'target-status-indicator status-cross';
          lossStatusIndicator.innerHTML = 'âœ—';
          lossTargetStatus.className = 'target-status-item loss';
        }
        
        // æ›´æ–°æ–‡æœ¬
        const lossText = lossTargetStatus.querySelector('span:first-child');
        if (lossText) {
          lossText.innerHTML = `ğŸ“‰ 25% daily loss limit`;
        }
      }
    }

    // é€‰æ‹©æ—¥æœŸå¹¶æ›´æ–°æ˜¾ç¤º
    async function selectDate(date) {
      try {
        selectedDate = date;
        
        // æ›´æ–°å·¦ä¾§åˆ—è¡¨çš„é€‰ä¸­çŠ¶æ€
        document.querySelectorAll('.date-history-item').forEach(item => {
          item.classList.remove('active');
          if (item.dataset.date === date) {
            item.classList.add('active');
            item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }
        });
        
        const dateData = dateHistoryData[date];
        if (!dateData) {
          console.error('No data for date:', date);
          return;
        }
        
        const currentLang = localStorage.getItem('language') || 'en';
        const today = new Date().toISOString().split('T')[0];
        
        // æ›´æ–°é€‰æ‹©çš„æ—¥æœŸæ˜¾ç¤º
        const selectedDateEl = document.getElementById('selectedDateValue');
        if (selectedDateEl) {
          const formattedDate = formatDateForDisplay(date, currentLang);
          selectedDateEl.textContent = date === today ? 
            (currentLang === 'zh' ? 'ä»Šå¤©' : 'Today') : 
            formattedDate;
        }
        
        // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
        const statusPill = document.getElementById('statusPill');
        const statusTextEl = document.getElementById('statusText');
        
        if (statusPill && statusTextEl) {
          statusPill.className = 'status-pill';
          
          let statusClass = dateData.status;
          let statusTranslationKey = dateData.status;
          
          if (!dateData.hasTrades) {
            statusClass = 'no-trades';
            statusTranslationKey = 'no_trades';
          }
          
          statusPill.classList.add(statusClass);
          
          const statusText = window.translations[currentLang]?.[statusTranslationKey] || statusTranslationKey;
          statusTextEl.textContent = statusText;
          
          const statusIcon = statusPill.querySelector('.status-icon');
          const statusIcons = {
            'passed': 'âœ…',
            'failed': 'âŒ',
            'patience': 'â³',
            'no_trades': 'ğŸ“Š'
          };
          
          if (statusIcon) {
            statusIcon.textContent = statusIcons[statusClass] || 'â³';
          }
        }
        
        // æ›´æ–°ç›ˆåˆ©ç›®æ ‡å¡ç‰‡
        const profitCurrentEl = document.getElementById('profitCurrent');
        const profitTargetValueEl = document.getElementById('profitTargetValue');
        const profitProgressEl = document.getElementById('profitProgress');
        const profitPercentageEl = document.getElementById('profitPercentage');
        const profitBadgeEl = document.getElementById('profitBadge');
        
        if (profitCurrentEl) {
          const profitAchieved = Math.max(0, dateData.totalPnl);
          const profitPercentage = dateData.profitTarget > 0 ? 
            Math.min(100, (profitAchieved / dateData.profitTarget) * 100) : 0;
          
          profitCurrentEl.textContent = profitAchieved.toFixed(2);
          profitTargetValueEl.textContent = dateData.profitTarget.toFixed(2);
          profitPercentageEl.textContent = `${profitPercentage.toFixed(1)}%`;
          
          if (profitProgressEl) {
            profitProgressEl.style.width = `${profitPercentage}%`;
            profitProgressEl.classList.add('progress-bar-animated');
            setTimeout(() => {
              profitProgressEl.classList.remove('progress-bar-animated');
            }, 1200);
          }
          
          if (profitBadgeEl) {
            if (profitPercentage >= 100) {
              profitBadgeEl.style.display = 'block';
              profitBadgeEl.parentElement.classList.add('quest-complete');
              setTimeout(() => {
                profitBadgeEl.parentElement.classList.remove('quest-complete');
              }, 600);
            } else {
              profitBadgeEl.style.display = 'none';
            }
          }
        }
        
        // æ›´æ–°äºæŸé™åˆ¶å¡ç‰‡
        const lossCurrentEl = document.getElementById('lossCurrent');
        const lossLimitValueEl = document.getElementById('lossLimitValue');
        const lossProgressEl = document.getElementById('lossProgress');
        const lossPercentageEl = document.getElementById('lossPercentage');
        
        if (lossCurrentEl) {
          const todayLoss = Math.max(0, -dateData.totalPnl);
          const lossPercentage = dateData.lossLimit > 0 ? 
            Math.min(100, (todayLoss / dateData.lossLimit) * 100) : 0;
          
          lossCurrentEl.textContent = todayLoss.toFixed(2);
          lossLimitValueEl.textContent = dateData.lossLimit.toFixed(2);
          lossPercentageEl.textContent = `${lossPercentage.toFixed(1)}%`;
          
          if (lossProgressEl) {
            lossProgressEl.style.width = `${lossPercentage}%`;
            lossProgressEl.classList.add('progress-bar-animated');
            setTimeout(() => {
              lossProgressEl.classList.remove('progress-bar-animated');
            }, 1200);
          }
        }
        
        // æ›´æ–°ç›®æ ‡çŠ¶æ€æŒ‡ç¤ºå™¨
        updateTargetStatusIndicators(dateData);
        
        // æ›´æ–°åº•éƒ¨æ€»ç»“
        const dailyResultEl = document.getElementById('dailyResult');
        const tradesCountEl = document.getElementById('tradesCount');
        const profitFactorEl = document.getElementById('profitFactor');
        
        if (dailyResultEl) {
          dailyResultEl.textContent = `$${dateData.totalPnl.toFixed(2)}`;
          dailyResultEl.className = 'summary-value ' + (dateData.totalPnl >= 0 ? 'positive' : 'negative');
        }
        
        if (tradesCountEl) {
          tradesCountEl.textContent = dateData.stats.tradeCount;
        }
        
        if (profitFactorEl) {
  const stats = dateData.stats;
  
  if (stats && stats.tradeCount > 0) {
    const pf = stats.profitFactor;
    
    // æ ¼å¼åŒ–æ˜¾ç¤º
    if (pf > 10) {
      profitFactorEl.textContent = "10.0+";
    } else if (pf >= 100) {
      profitFactorEl.textContent = "99.9";
    } else {
      profitFactorEl.textContent = pf.toFixed(1);
    }
    
    // è®¾ç½®é¢œè‰²
    if (pf >= 2.0) {
      profitFactorEl.className = 'summary-value positive';
    } else if (pf >= 1.5) {
      profitFactorEl.className = 'summary-value';
    } else if (pf >= 1.0) {
      profitFactorEl.className = 'summary-value';
    } else if (pf > 0) {
      profitFactorEl.className = 'summary-value negative';
    } else {
      profitFactorEl.className = 'summary-value';
    }
  } else {
    // æ²¡æœ‰äº¤æ˜“è®°å½•
    profitFactorEl.textContent = "0.0";
    profitFactorEl.className = 'summary-value';
  }
}
        
        // æ›´æ–°æè¿°æ–‡æœ¬
        const profitTargetDescEl = document.getElementById('profitTargetDesc');
        const lossLimitDescEl = document.getElementById('lossLimitDesc');
        
        if (profitTargetDescEl) {
          profitTargetDescEl.textContent = currentLang === 'zh' ? 
            `åŸºäºå½“æ—¥ä½™é¢ (${dateData.startingBalance.toFixed(2)})` :
            `Based on daily balance (${dateData.startingBalance.toFixed(2)})`;
        }
        
        if (lossLimitDescEl) {
          lossLimitDescEl.textContent = currentLang === 'zh' ? 
            `åŸºäºå½“æ—¥ä½™é¢ (${dateData.startingBalance.toFixed(2)})` :
            `Based on daily balance (${dateData.startingBalance.toFixed(2)})`;
        }
        
      } catch (error) {
        console.error('Error selecting date:', error);
        showToast('Error loading date data', 'error');
      }
    }

    // æ›´æ–°ç»Ÿè®¡æ‘˜è¦ - ä¿®å¤ç‰ˆæœ¬
    function updateStatsSummary() {
      const statsSummaryEl = document.getElementById('statsSummary');
      if (!statsSummaryEl) return;
      
      const currentLang = localStorage.getItem('language') || 'en';
      
      let totalProfit = 0;
      let totalTrades = 0;
      let totalWinTrades = 0;
      let maxProfit = 0;
      let maxLoss = 0;
      let currentStreak = 0;
      let consistency = 0;
      
      // è®¡ç®—åŸºæœ¬ç»Ÿè®¡æ•°æ®
      Object.values(dateHistoryData).forEach(data => {
        if (data.hasTrades) {
          totalProfit += data.totalPnl;
          totalTrades += data.stats.tradeCount;
          totalWinTrades += data.stats.winCount;
          
          if (data.stats.maxProfit > maxProfit) maxProfit = data.stats.maxProfit;
          if (data.stats.maxLoss < maxLoss) maxLoss = data.stats.maxLoss;
        }
      });
      
      // è®¡ç®—è¿èƒœå¤©æ•° - ä»æœ€è¿‘æ—¥æœŸå¼€å§‹å¾€å‰æ£€æŸ¥
      const sortedDates = Object.keys(dateHistoryData).sort((a, b) => {
        return new Date(b) - new Date(a); // æ—¥æœŸå€’åºï¼šæœ€æ–°çš„åœ¨å‰
      });
      
      // éå†æ’åºåçš„æ—¥æœŸ
      for (const date of sortedDates) {
        const data = dateHistoryData[date];
        
        // è·³è¿‡æ²¡æœ‰äº¤æ˜“çš„æ—¥æœŸ
        if (!data.hasTrades) {
          continue;
        }
        
        // å¦‚æœå½“å¤©çŠ¶æ€ä¸ºpassedï¼Œå¢åŠ è¿èƒœè®¡æ•°
        if (data.status === 'passed') {
          currentStreak++;
        } else {
          // é‡åˆ°épassedçŠ¶æ€ï¼Œåœæ­¢è®¡æ•°
          break;
        }
      }
      
      const totalDays = Object.keys(dateHistoryData).length;
      const tradingDays = Object.values(dateHistoryData).filter(d => d.hasTrades).length;
      consistency = totalDays > 0 ? (tradingDays / totalDays) * 100 : 0;
      
      const stats = [
        {
          title: 'total_profit',
          value: `$${totalProfit.toFixed(2)}`,
          class: totalProfit >= 0 ? 'positive' : 'negative'
        },
        {
          title: 'total_trades',
          value: totalTrades,
          class: ''
        },
        {
          title: 'win_rate',
          value: totalTrades > 0 ? `${((totalWinTrades / totalTrades) * 100).toFixed(1)}%` : '0%',
          class: ''
        },
        {
          title: 'avg_profit',
          value: totalTrades > 0 ? `$${(totalProfit / totalTrades).toFixed(2)}` : '$0.00',
          class: (totalProfit / totalTrades) >= 0 ? 'positive' : 'negative'
        },
        {
          title: 'max_profit',
          value: `$${maxProfit.toFixed(2)}`,
          class: 'positive'
        },
        {
          title: 'max_loss',
          value: `$${maxLoss.toFixed(2)}`,
          class: 'negative'
        },
        {
          title: 'consistency',
          value: `${consistency.toFixed(1)}%`,
          class: ''
        },
        {
          title: 'current_streak',
          value: `${currentStreak} ${currentLang === 'zh' ? 'å¤©' : 'days'}`,
          class: currentStreak > 0 ? 'positive' : ''
        }
      ];
      
      statsSummaryEl.innerHTML = stats.map(stat => `
        <div class="stat-card">
          <h4>${window.translations[currentLang]?.[stat.title] || stat.title}</h4>
          <div class="value ${stat.class}">${stat.value}</div>
        </div>
      `).join('');
    }

    // æ˜¾ç¤ºToasté€šçŸ¥
    function showToast(message, type = 'info') {
      const existingToast = document.querySelector('.toast-notification');
      if (existingToast) {
        existingToast.remove();
      }
      
      const toast = document.createElement('div');
      toast.className = `toast-notification toast-${type}`;
      toast.innerHTML = `
        <div class="toast-content">
          <span class="toast-icon">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span>
          <span class="toast-message">${message}</span>
        </div>
      `;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('show');
      }, 10);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          if (toast.parentNode) {
            toast.remove();
          }
        }, 300);
      }, 3000);
    }

    // åˆå§‹åŒ–é¡µé¢
    document.addEventListener('DOMContentLoaded', function() {
      // æ£€æŸ¥ç™»å½•çŠ¶æ€
      checkAuth().then(session => {
        if (session && currentUserId) {
          loadAllDateRecords(currentUserId);
          
          setInterval(() => {
            loadAllDateRecords(currentUserId);
          }, 30000);
        }
      });
      
      // åˆå§‹åŒ–è¯­è¨€
      if (window.initLanguage) {
        window.initLanguage();
      }
      
      // æ·»åŠ å¡ç‰‡æ‚¬åœæ•ˆæœ
      document.querySelectorAll('.premium-card').forEach(card => {
        card.addEventListener('mouseenter', () => {
          card.style.transform = 'translateY(-6px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', () => {
          card.style.transform = 'translateY(0) scale(1)';
        });
      });
    });
    
    // ç›‘å¬è¯­è¨€å˜åŒ–
    window.addEventListener('languageChanged', () => {
      if (selectedDate) {
        selectDate(selectedDate);
      }
      updateStatsSummary();
    });
  </script>
</body>
</html>